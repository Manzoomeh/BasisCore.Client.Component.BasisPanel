<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="assets/css/styles.css" />
    <link href="assets/css/LineIcons.css" rel="stylesheet" />
  </head>
  <body>
    <div class="business_render" id="submit_page"></div>
    <Basis core="component.basispanel.panel" run="atclient"> </Basis>
    <div class="clr"></div>

    <script>
      function toggle_item(el, a) {
        var selector = el
          .closest(".selectable")
          .querySelector(".selectable_list");
        var status = selector.getAttribute("data-status");
        if (status == "close") {
          selector.style.opacity = "1";
          selector.style.zIndex = "99";
          selector.setAttribute("data-status", "open");
        } else {
          selector.style.opacity = "0";
          selector.style.zIndex = "-1";
          selector.setAttribute("data-status", "close");
        }
      }
      function openSlidingMenu(e) {
        var currentItem = e.nextSibling;
        var icon = e.querySelector(".lni");
        var opened = currentItem.getAttribute("data-open");
        if (opened == "true") {
          slidingMenu(currentItem, 300, false);
          currentItem.setAttribute("data-open", "false");
          icon.classList.remove("lni-chevron-right");
          icon.classList.add("lni-chevron-left");
        } else if (opened == "false") {
          slidingMenu(currentItem, 300, true);
          currentItem.setAttribute("data-open", "true");
          icon.classList.remove("lni-chevron-left");
          icon.classList.add("lni-chevron-right");
        }
      }

      function slidingMenu(el, duration, isDown) {
        el.style.overflow = "hidden";
        el.style.height = "100%";
        if (isDown) el.style.display = "inline-block";
        var elStyles = window.getComputedStyle(el);
        var elWidth = parseFloat(elStyles.getPropertyValue("width"));
        var stepWidth = elWidth / duration;
        var start;

        function step(timestamp) {
          if (start === undefined) start = timestamp;
          var elapsed = timestamp - start;
          if (isDown) {
            el.style.width = stepWidth * elapsed + "px";
          } else {
            el.style.width = elWidth - stepWidth * elapsed + "px";
          }
          if (elapsed >= duration) {
            el.style.width = "";
            el.style.overflow = "";
            if (!isDown) el.style.display = "none";
          } else {
            window.requestAnimationFrame(step);
          }
        }
        window.requestAnimationFrame(step);
      }
      function openSubmenu(e) {
        var icon = e.querySelector(".lni");
        icon.classList.toggle("lni-chevron-down");
        icon.classList.toggle("lni-chevron-up");

        var nextPanel = e.nextElementSibling;
        slideToggle(nextPanel, 200);

        // to make other panels collapse when you open one:
        var allPanels = document.querySelectorAll(".submenu");
        allPanels.forEach(function (el) {
          if (el.style.display !== "none" && el !== nextPanel) slideUp(el, 200);
        });
      }
      function slideToggle(el, duration, callback) {
        if (el.clientHeight === 0) {
          _s(el, duration, callback, true);
        } else {
          _s(el, duration, callback);
        }
      }

      function slideUp(el, duration, callback) {
        _s(el, duration, callback);
      }

      function slideDown(el, duration, callback) {
        _s(el, duration, callback, true);
      }
      function _s(el, duration, callback, isDown) {
        if (typeof duration === "undefined") duration = 400;
        if (typeof isDown === "undefined") isDown = false;
        el.style.overflow = "hidden";
        if (isDown) el.style.display = "block";
        var elStyles = window.getComputedStyle(el);
        var elHeight = parseFloat(elStyles.getPropertyValue("height"));
        var elPaddingTop = parseFloat(elStyles.getPropertyValue("padding-top"));
        var elPaddingBottom = parseFloat(
          elStyles.getPropertyValue("padding-bottom")
        );
        var elMarginTop = parseFloat(elStyles.getPropertyValue("margin-top"));
        var elMarginBottom = parseFloat(
          elStyles.getPropertyValue("margin-bottom")
        );
        var stepHeight = elHeight / duration;
        var stepPaddingTop = elPaddingTop / duration;
        var stepPaddingBottom = elPaddingBottom / duration;
        var stepMarginTop = elMarginTop / duration;
        var stepMarginBottom = elMarginBottom / duration;
        var start;

        function step(timestamp) {
          if (start === undefined) start = timestamp;
          var elapsed = timestamp - start;
          if (isDown) {
            el.style.height = stepHeight * elapsed + "px";
            el.style.paddingTop = stepPaddingTop * elapsed + "px";
            el.style.paddingBottom = stepPaddingBottom * elapsed + "px";
            el.style.marginTop = stepMarginTop * elapsed + "px";
            el.style.marginBottom = stepMarginBottom * elapsed + "px";
          } else {
            el.style.height = elHeight - stepHeight * elapsed + "px";
            el.style.paddingTop =
              elPaddingTop - stepPaddingTop * elapsed + "px";
            el.style.paddingBottom =
              elPaddingBottom - stepPaddingBottom * elapsed + "px";
            el.style.marginTop = elMarginTop - stepMarginTop * elapsed + "px";
            el.style.marginBottom =
              elMarginBottom - stepMarginBottom * elapsed + "px";
          }
          if (elapsed >= duration) {
            el.style.height = "";
            el.style.paddingTop = "";
            el.style.paddingBottom = "";
            el.style.marginTop = "";
            el.style.marginBottom = "";
            el.style.overflow = "";
            if (!isDown) el.style.display = "none";
            if (typeof callback === "function") callback();
          } else {
            window.requestAnimationFrame(step);
          }
        }
        window.requestAnimationFrame(step);
      }
      function select_owner(el, e) {
        var ownerid = el.getAttribute("data-id");

        document.querySelector(".service_name").textContent = el.textContent;
        document
          .querySelector(".service_name")
          .setAttribute("onclick", "menu_maker(" + ownerid + ", 0)");
        // change event toggle
        document
          .querySelector(".select_service")
          .querySelector(".select_item")
          .setAttribute("onclick", "");
        document
          .querySelector(".service_toggle")
          .setAttribute("onclick", "toggle_item(this)");
        // reset business box setting
        document.querySelector(".business_name").textContent =
          "کسب‌وکار مورد نظر را انتخاب کنید";
        // document.querySelector('.business_name').style.color = "#bcbcbc";
        document
          .querySelector(".business_name")
          .classList.add("first_item_show_deactive");
        document.querySelector(".business_name").setAttribute("onclick", "");
        document
          .querySelector(".select_business")
          .querySelector(".select_item")
          .setAttribute("onclick", "toggle_item(this)");
        document.querySelector(".business_toggle").setAttribute("onclick", "");

        var selector = el
          .closest(".selectable")
          .querySelector(".selectable_list");
        selector.style.opacity = "0";
        selector.style.zIndex = "-1";
        selector.setAttribute("data-status", "close");

        menu_maker(ownerid, 0);
        document.querySelector(".loading").style.display = "block";

        document.querySelector(".business_list").innerHTML =
          '<div class="filterInput"><input type="text" class="form_element" placeholder="جستجوی کسب و کار ..." id="businessInput" value=""></div><ul id="businessInput_autocompleteList"></ul>';
      }
      function select_business(el, ownerid, dmnid) {
        document.querySelector(".business_name").textContent = el.textContent;
        // document.querySelector('.business_name').style.color = "#212121";
        document
          .querySelector(".business_name")
          .classList.remove("first_item_show_deactive");
        document
          .querySelector(".business_name")
          .setAttribute(
            "onclick",
            "menu_maker(" + ownerid + ", " + dmnid + ")"
          );
        // change event toggle
        document
          .querySelector(".select_business")
          .querySelector(".select_item")
          .setAttribute("onclick", "");
        document
          .querySelector(".business_toggle")
          .setAttribute("onclick", "toggle_item(this)");

        var selector = el
          .closest(".selectable")
          .querySelector(".selectable_list");
        selector.style.opacity = "0";
        selector.style.zIndex = "-1";
        selector.setAttribute("data-status", "close");
      }
    </script>
    <script>
      const host = {
        settings: {
          "basispanel.option": {
            rKey: "1229BF0C-D2F1-4172-9817-9E8E87BF35BE",
            accountingUrl: "/server/trust/${rKey}/profile",
            profileMenuUrl: "/server/trust/${rKey}/menu",
            profileImageUrl:
              "https://trust-login.com/${rKey}/users/${profile.thumbnail}",
          },
        },
        repositories: {
          basispanel: "/basiscore.basispanel.component.js",
        },
      };
    </script>
    <script src="http://localhost:3000/basiscore.min.js"></script>
  </body>
</html>
