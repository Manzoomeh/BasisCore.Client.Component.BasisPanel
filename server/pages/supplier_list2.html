

<script src="https://cdn.basiscore.net/_js/alasql.min.js"></script>
<basis core="dbsource" source="fingerfoodapi" name="db" run="atclient" cache="refresh">
    <member request="supplier_list" type="list" name="supplier_list1" preview="true"></member>
</basis>

<div class="supplier_resize">
<Basis core="component.bc.grid" run="atclient" datamembername="db.supplier_list1" options-object="options"></Basis>
</div>
<div id="editModal" class="modal ">


<div class="modal-background" onclick="hideModal('editModal')"></div>
<div class="modal-content">
    <div class="modal-title">
        <span>ویرایش</span>
        <span id="modalClose" class="close no-select" onclick="hideModal('editModal')">×</span>
    </div>
    <div class="modal-body" style="display:none">
        <form class="sample-form" bc-triggers="submit"  name="cms.form"  autocomplete="off" >
           
            <div class="sample-form-box">
                <span>نام و نام‌خانوادگی: </span>
                <input type="text" name="title" value="" />
            </div>
            <div class="sample-form-box">
                <span>نام برند : </span>
                <input type="text" name="brand" value="" />
            </div>
            
            <div class="sample-form-box">
                <span>تلفن : </span>
                <input type="text" name="phone" value="">
            </div>
            
            <div class="sample-form-box">
                <span>توضیحات : </span>
                <textarea type="text" name="description" ></textarea>
            </div>
            <input type="submit" class="submitForm" value="ذخیره" />
            <div id="message" class="message">
                <basis core="print" datamembername="db.save_supplier" run="atclient">
                    <face>
                        <script type="text/template">
                        تامین‌کننده جدید با موفقیت اضافه شد.
                    </script>
                    </face>
                </basis>
            </div>
            <div class="data_tbl">
                <div class="data_tbl_header">
                    <p>محصولات قابل ارائه</p>
                    <button onclick="add_row(this)">افزودن سطر جدید </button>
                </div>
                
                <table id="supplier_product_list">
                    <thead>
                    
                        <th>نام محصول</th>
                        <th>تنوع محصول</th>
                        <th>عملیات</th>
                    
                </thead>
                <tbody>
                   

                    <tr >
                        <td class="section-2">
                            <basis core="dbsource" source="basiscoreapi" name="db" run="atclient" cache="refresh" mid="20" lid="1" triggers="db.inventoryId">
                                <member  type="list" name="products" perpage="10" order="id desc"  preview=""></member>
                            </basis>
                            <basis core="print" datamembername="db.products" run="atclient">
                                <layout>
                                    <script type="text/template">
                                    <select onChange="getInventoryId(this)" data-a="" >
                                        @child
                                    </select>
                                </script>
                                </layout>
                                <face>
                                    <script type="text/template">
                                        <option value="@id@">@title@</option>
                                    </script>
                                </face>
                            </basis>
                        </td>
                        <td class="section-3">
                            <basis core="dbsource" source="accountingapi" run="atclient" name="db" mid="43" lid="1" mainid="[##db.inventoryId.value|(1423245)##]" triggers="db.inventoryId">
                                <member type="list" name="fingerfood_inventory" typeid="150"  preview="true" postsql="select title from [db.fingerfood_inventory]"  ></member>
                            </basis>
                          
                            <basis core="print" datamembername="db.fingerfood_inventory" run="atclient" >
                                <layout>
                                    <script type="text/template">
                                    <select>
                                        @child
                                    </select>
                                </script>
                                </layout>
                                <face>
                                    <script type="text/template">
                                        <option> @title@ </option>
                                    </script>
                                </face>
                            </basis>
                        </td>
                        <td>
                            <div class="add_tr"><i class="lni lni-save"></i></div>
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
            
            <div class="clr"></div>
        </form>
    </div>
</div>
</div>
<basis core="dbsource" source="fingerfoodapi" name="db" run="atclient" cache="refresh" title="[##cms.form.title##]" brand="[##cms.form.brand##]" 
phone="[##cms.form.phone##]" description="[##cms.form.title##]" triggers="cms.form" if="[##cms.form1.value##]">
<member request="save_supplier" type="scalar" name="save_supplier" preview=""></member>
</basis>

<script>
    $bc.setSource("cms.form1" , false)
     var fingerFoodSettings = {
         repositories: {
             "bc.grid": "basiscore.grid.component.js"
         },
         settings: {
             'connection.web.callcommand': 'http://127.0.0.1:8081/',
                'connection.web.fingerfoodapi': 'https://dbsource.basiscore.net/data.json',
                'connection.web.trust_loginuiapi': 'https://dbsource.basiscore.net/data.json',
                'connection.web.basiscoreapi': 'https://dbsource.basiscore.net/data.json',
                'connection.web.accountingapi': 'https://dbsource.basiscore.net/data.json',
                'default.dmnid': 4235,
                'default.dbsource.verb': 'post',
                'default.call.verb': 'get',
             
         }                
     }
     const bc2 = $bc
        .new()
        .addFragment('.section-2')
        .setOptions(fingerFoodSettings)
        .run();
    const bc3 = $bc
        .new()
        .addFragment('.section-3')
        .setOptions(fingerFoodSettings)
        .run();
    function getInventoryId(el){
        bc3.setSource("db.inventoryId", el.value).run();
     }
     const options = {
         columns: {
             rownumber : "ردیف" , 
             id: {
                 title: "کد تامین‌کننده",
                 
             },
             title: {
                 title: "عنوان",
                 sort : true                        
             },
             phone: "شماره تماس",
             action: {
                 title: "عملیات",
                 actions: [
                     {
                         label: "edit",
                         action: onClickRowEditBtn,
                         iconClass: "lni lni-pencil-alt",
                     }, {
                         label: "calendar",
                         url: (data) => `?p=${
                             data.id
                         }`,
                         iconClass: "lni lni-calendar",
                     }, {
                         label: "accessories",
                         url: "#",
                         iconClass: "lni lni-bar-chart"
                     },
                 ]
             }

         },
         
         defaultSort: {
             name: "count"
         },
         pageSize: [20]
     };
     function onClickRowEditBtn(data, tr){
         console.log(data, tr);
         $bc.setSource("list.search",data.id)
     
     }
     function supplierNew() {            
     showModal("editModal");
     $bc.setSource("cms.form1" , true)
 }
 
</script>
<script>
 function showModal(id) {
     let modal_wrapper = document.getElementById(id);
     modal_wrapper.style.display = "block";
 }

 function hideModal(id) {
     let modal_el = document.getElementById(id);
     modal_el.style.display = "none";
 }
 function add_row(el){
    let tbl  = document.getElementById("supplier_product_list")
    let first_row = tbl.querySelectorAll('tr');
    let tbl1 = tbl.querySelectorAll("tbody")
    let new_row = document.createElement("tr")
    new_row.innerHTML =  first_row[1].innerHTML
    tbl1[0].appendChild(new_row) 
 }
</script>